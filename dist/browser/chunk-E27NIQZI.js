import{a as Tt}from"./chunk-WG7QQHNH.js";import{A as lt,B as pt,C as dt,F as st,G as ct,H as ut,I as _t,J as ft,K as ht,L as Ct,M as yt,N as gt,O as St,P as xt,R as Pt,S as T,T as Dt,X as Ht,Y as vt,a as K,c as X,d as Y,e as Z,g as L,h as tt,i as et,j as it,ka as w,u as nt,v as at,x as ot,y as rt,z as mt}from"./chunk-7RWZJSZU.js";import{h as q,k as J}from"./chunk-QNDYK3DZ.js";import{m as j,q as B}from"./chunk-WLRUUNHX.js";import{Ab as o,Bb as C,C as F,Cb as u,Db as _,Fb as $,Kb as H,Mb as h,Qb as E,R as N,Rb as I,Sa as M,Sb as b,Ub as m,Va as p,Vb as W,Wa as z,Wb as y,ac as v,bc as k,ca as x,cc as G,dc as Q,fc as U,ha as P,mb as s,nb as V,ob as c,qa as O,ra as A,ub as D,zb as a}from"./chunk-JETHE2PU.js";import{a as g,b as S,g as R}from"./chunk-DM275RSA.js";function Et(t,e){if(t&1&&C(0,"p",1),t&2){let n=h();c("innerText",n.data.summary)}}function It(t,e){t&1&&(a(0,"p"),m(1,"no summary"),o())}var wt=(()=>{let e=class e{constructor(i){this.data=i}};e.\u0275fac=function(r){return new(r||e)(z(ot))},e.\u0275cmp=P({type:e,selectors:[["app-summary-dialoge"]],standalone:!0,features:[v],decls:8,vars:1,consts:[["mat-dialog-title",""],[3,"innerText"],["align","end"],["mat-button","","mat-dialog-close","","color","primary"]],template:function(r,l){r&1&&(a(0,"h2",0),m(1,"Summary"),o(),a(2,"mat-dialog-content"),s(3,Et,1,1,"p",1)(4,It,2,0),o(),a(5,"mat-dialog-actions",2)(6,"button",3),m(7,"Close"),o()()),r&2&&(p(3),D(3,l.data.summary?3:4))},dependencies:[w,nt,mt,lt,dt,pt]});let t=e;return t})();var bt=["audioControl"],Rt=()=>[5,10,20],Ft=t=>({"background-color":t});function Nt(t,e){t&1&&(a(0,"th",33),m(1," Sr no "),o())}function Ot(t,e){if(t&1&&(a(0,"td",34),m(1),o()),t&2){let n=e.index,i=h();p(),y(" ",i.getIndex(n)," ")}}function At(t,e){t&1&&(a(0,"th",35),m(1," Patient Name "),o())}function zt(t,e){if(t&1&&(a(0,"td",34),m(1),o()),t&2){let n=e.$implicit;p(),y(" ",n.PatientName," ")}}function Vt(t,e){t&1&&(a(0,"th",36),m(1," Patient Id "),o())}function $t(t,e){if(t&1&&(a(0,"td",34),m(1),o()),t&2){let n=e.$implicit;p(),y(" ",n.PatientId," ")}}function Wt(t,e){t&1&&(a(0,"th",33),m(1," Audio "),o())}function kt(t,e){if(t&1){let n=$();a(0,"td",34)(1,"audio",37,0),H("play",function(){let r=O(n).index,l=h();return A(l.onPlay(r))}),C(3,"source",38),o()()}if(t&2){let n=e.$implicit;p(3),c("src",n.audioFileURL,M)}}function Gt(t,e){t&1&&(a(0,"th",39),m(1,"Template"),o())}function Qt(t,e){if(t&1&&(a(0,"td",34),m(1),o()),t&2){let n=e.$implicit;p(),y(" ",n==null?null:n.prompt," ")}}function Ut(t,e){t&1&&(a(0,"th",40),m(1," Patient Type "),o())}function jt(t,e){if(t&1&&(a(0,"td",34),m(1),o()),t&2){let n=e.$implicit;p(),y(" ",n.typeId===1?"IPD":n.typeId?"OPD":"none"," ")}}function Bt(t,e){t&1&&(a(0,"th",41),m(1,"Status"),o())}function qt(t,e){if(t&1&&(a(0,"span",42),m(1),o()),t&2){let n=h().$implicit,i=h();c("ngStyle",G(2,Ft,n.progressStatus!=="4"?"#8d79f4":"#339133")),p(),W(i.completedStatus[n.progressStatus])}}function Jt(t,e){if(t&1&&(a(0,"td",34),s(1,qt,2,4,"span",42),o()),t&2){let n=e.$implicit;p(),D(1,n.progressStatus?1:-1)}}function Kt(t,e){t&1&&(a(0,"th",43),m(1," Created Date "),o())}function Xt(t,e){if(t&1&&(a(0,"td",34),m(1),Q(2,"date"),o()),t&2){let n=e.$implicit;p(),y(" ",U(2,1,n.createdDate,"d-MMMM-y")," ")}}function Yt(t,e){t&1&&(a(0,"th",33),m(1,"Report"),o())}function Zt(t,e){if(t&1&&(a(0,"td",34)(1,"a",44)(2,"mat-icon"),m(3,"download"),o()()()),t&2){let n=e.$implicit;p(),c("href",n.reportUrl,M)}}function Lt(t,e){t&1&&(a(0,"th",33),m(1,"View Details"),o())}function te(t,e){if(t&1&&(a(0,"td",34)(1,"a",45)(2,"mat-icon"),m(3,"visibility"),o()()()),t&2){let n=e.$implicit;p(),c("routerLink","/home/patient/patient-details/"+n.id)}}function ee(t,e){if(t&1&&(a(0,"tr",46)(1,"td",47),m(2," No Data Available."),o()()),t&2){let n=h();p(),V("colspan",n.displayedColumns.length)}}function ie(t,e){t&1&&C(0,"tr",48)}function ne(t,e){if(t&1&&C(0,"tr",49),t&2){let n=e.$implicit;c("id",n.id)}}var Ie=(()=>{let e=class e{constructor(){this.displayedColumns=["Sr no","Patient Name","Patient Id","Audio","Patient Type","Prompt Name","Status","Created Date","Report","View Details"],this.dataSource=[],this.pagination={search_key:"",search_column:"",page:1,per_page:10},this.totalCount=0,this.modalService=x(rt),this.patientService=x(Tt),this.activatedRoute=x(q),this.completedStatus={0:"Patient Added",1:"Transcript Completed",2:"Optimize Transcript Completed",3:"Summary Completed",4:"Completed"}}ngOnInit(){let i=this.activatedRoute.snapshot.paramMap.get("id");i&&(this.patientId=i,sessionStorage.setItem("doctorId",this.patientId)),this.searchForm=new Z({search:new L("")}),this.searchForm.get("search")?.valueChanges.pipe(F(500),N(r=>R(this,null,function*(){return this.loadPatientHistory(S(g({},this.pagination),{search_key:r}))}))).subscribe()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.loadPatientHistory(this.pagination)}loadPatientHistory(i){let r=S(g({},i),{created_by_id:+this.patientId});this.patientService.retrievePatientHistory(r).subscribe({next:l=>{if(l){let f=l;this.dataSource=f.data.map(d=>({id:d.id,PatientName:d.patient_name,PatientId:d.patient_id,audio:d.audio_file,typeId:d.type_id,audioFileURL:d.file_url,prompt:d.prompt,progressStatus:d.progress_status,createdDate:d.created_at,transcript:d.transcript,optimizedSummary:d.optimize_transcript,citation:d.citation,summary:d.summary,reportUrl:d.report_url?d.report_url.trim():""})),this.pagination.page=f.meta.current_page,this.pagination.per_page=f.meta.per_page,this.totalCount=f.meta.total}}})}showModal(i,r){this.modalService.open(Dt,{width:"800px",data:{data:r==="Citations"?JSON.parse(i):i,modalTitle:r}})}showsummaryModal(i){this.modalService.open(wt,{width:"800px",data:{summary:i}})}handlePagination(i){let r=S(g({},this.pagination),{page:i.pageIndex+1,per_page:i.pageSize});this.loadPatientHistory(r)}sortFunction(i){let r=S(g({},this.pagination),{order:i.direction,order_by:i.active});this.loadPatientHistory(r)}searchFunction(i){let r=S(g({},this.pagination),{search_key:i});this.loadPatientHistory(r)}getIndex(i){return i+1+this.paginator.pageIndex*this.paginator.pageSize}downloadReport(i){this.patientService.downloadReport(i).subscribe()}onPlay(i){console.log(Array.from(this.audioControl).forEach((r,l)=>{l!==i&&r.nativeElement.pause()}))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=P({type:e,selectors:[["app-patient-history"]],viewQuery:function(r,l){if(r&1&&(E(T,5),E(bt,5)),r&2){let f;I(f=b())&&(l.paginator=f.first),I(f=b())&&(l.audioControl=f)}},standalone:!0,features:[v],decls:47,vars:8,consts:[["audioControl",""],[1,"patientHistoryWrapper"],[1,""],[1,"header","d-flex","align-items-center","justify-content-between","mx-3"],[1,"title"],[1,"action","d-flex","align-items-center","justify-content-between","my-3"],[1,"filterToolbar"],[3,"formGroup"],["type","search","placeholder","Search","formControlName","search",1,"input-grey-rounded"],[1,"tableWrapper","m-3"],["mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","Sr no"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Patient Name"],["mat-header-cell","","mat-sort-header","patient_name",4,"matHeaderCellDef"],["matColumnDef","Patient Id"],["mat-header-cell","","mat-sort-header","patient_id",4,"matHeaderCellDef"],["matColumnDef","Audio"],["matColumnDef","Prompt Name"],["mat-header-cell","","mat-sort-header","prompt",4,"matHeaderCellDef"],["matColumnDef","Patient Type"],["mat-header-cell","","mat-sort-header","type_id",4,"matHeaderCellDef"],["matColumnDef","Status"],["mat-header-cell","","mat-sort-header","progress_status",4,"matHeaderCellDef"],["matColumnDef","Created Date"],["mat-header-cell","","mat-sort-header","created_at",4,"matHeaderCellDef"],["matColumnDef","Report"],["matColumnDef","View Details"],["class","mat-row text-center","style","height: 60px;",4,"matNoDataRow"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"id",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","true","aria-label","Select page of periodic elements",3,"page","pageSizeOptions","pageSize","length"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","","mat-sort-header","patient_name"],["mat-header-cell","","mat-sort-header","patient_id"],["controls","",3,"play"],["type","audio/mp3",3,"src"],["mat-header-cell","","mat-sort-header","prompt"],["mat-header-cell","","mat-sort-header","type_id"],["mat-header-cell","","mat-sort-header","progress_status"],[1,"completionTag",3,"ngStyle"],["mat-header-cell","","mat-sort-header","created_at"],["matTooltip","download pdf",1,"btn",3,"href"],[3,"routerLink"],[1,"mat-row","text-center",2,"height","60px"],[1,"mat-cell"],["mat-header-row",""],["mat-row","",3,"id"]],template:function(r,l){r&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h4"),m(5,"Patient's History Listing"),o()(),a(6,"div",5)(7,"div",6)(8,"form",7),C(9,"input",8),o()()()(),a(10,"div",9)(11,"table",10),H("matSortChange",function(d){return l.sortFunction(d)}),u(12,11),s(13,Nt,2,0,"th",12)(14,Ot,2,1,"td",13),_(),u(15,14),s(16,At,2,0,"th",15)(17,zt,2,1,"td",13),_(),u(18,16),s(19,Vt,2,0,"th",17)(20,$t,2,1,"td",13),_(),u(21,18),s(22,Wt,2,0,"th",12)(23,kt,4,1,"td",13),_(),u(24,19),s(25,Gt,2,0,"th",20)(26,Qt,2,1,"td",13),_(),u(27,21),s(28,Ut,2,0,"th",22)(29,jt,2,1,"td",13),_(),u(30,23),s(31,Bt,2,0,"th",24)(32,Jt,2,1,"td",13),_(),u(33,25),s(34,Kt,2,0,"th",26)(35,Xt,3,4,"td",13),_(),u(36,27),s(37,Yt,2,0,"th",12)(38,Zt,4,1,"td",13),_(),u(39,28),s(40,Lt,2,0,"th",12)(41,te,4,1,"td",13),_(),u(42),s(43,ee,3,1,"tr",29),_(),s(44,ie,1,0,"tr",30)(45,ne,1,1,"tr",31),o(),a(46,"mat-paginator",32),H("page",function(d){return l.handlePagination(d)}),o()()()()),r&2&&(p(8),c("formGroup",l.searchForm),p(3),c("dataSource",l.dataSource),p(33),c("matHeaderRowDef",l.displayedColumns),p(),c("matRowDefColumns",l.displayedColumns),p(),c("pageSizeOptions",k(7,Rt))("pageSize",l.pagination.per_page)("length",l.totalCount))},dependencies:[w,j,tt,K,X,Y,et,it,at,J,st,ut,Ct,_t,ct,yt,ft,ht,gt,St,xt,T,Pt,Ht,vt,B],styles:[".patientHistoryWrapper[_ngcontent-%COMP%]{max-width:1800px;margin:0 auto}.patientHistoryWrapper[_ngcontent-%COMP%]   .patientListWrapper[_ngcontent-%COMP%]{background:#a799f170;height:100%}.patientHistoryWrapper[_ngcontent-%COMP%]   .tableWrapper[_ngcontent-%COMP%]{margin:10px 0;border:1px solid #ddd;overflow-x:auto}.patientHistoryWrapper[_ngcontent-%COMP%]   .viewBtn[_ngcontent-%COMP%]{background:#4b49ac;color:#fff}.patientHistoryWrapper[_ngcontent-%COMP%]   .noData[_ngcontent-%COMP%]{text-align:center;margin:30px 0}.patientHistoryWrapper[_ngcontent-%COMP%]   .completionTag[_ngcontent-%COMP%]{padding:4px;text-align:center;color:#fff;border-radius:50px}"]});let t=e;return t})();export{Ie as a};
